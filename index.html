<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debate Filos√≥fico - Chat</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Debate Filos√≥fico: Vida despues de la Muerte</h1>
            <p class="subtitle">Un di√°logo entre la visi√≥n cient√≠fica y la espiritual</p>
            <p class="description">
                Este debate simulado explora las diferentes perspectivas sobre la naturaleza de la conciencia, 
                la vida despu√©s de la muerte y el significado de la existencia, desde dos enfoques fundamentales: 
                el cient√≠fico-materialista y el espiritual.
            </p>
        </header>

        <div class="participants">
            <div class="participant">
                <div style="width:80px;height:80px;border-radius:50%;background:#E74C3C;display:flex;align-items:center;justify-content:center;color:white;font-size:2em;margin:0 auto 10px;">üî¨</div>
                <h3>Stephen Hawking</h3>
                <p>F√≠sico te√≥rico y cosm√≥logo</p>
                <p>Perspectiva cient√≠fica-materialista</p>
            </div>
            <div class="participant">
                <div style="width:80px;height:80px;border-radius:50%;background:#16A085;display:flex;align-items:center;justify-content:center;color:white;font-size:2em;margin:0 auto 10px;">‚ò∏Ô∏è</div>
                <h3>Dalai Lama</h3>
                <p>L√≠der espiritual tibetano</p>
                <p>Perspectiva budista-espiritual</p>
            </div>
        </div>

        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <div class="message system">
                    <div class="message-content">
                        Haz clic en "Iniciar Debate" para comenzar la conversaci√≥n...
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button id="startDebateBtn" class="debate-button">
                üé≠ Iniciar Debate
            </button>
            <div class="config-controls">
                <label for="roundsInput">Rondas del debate:</label>
                <input type="number" id="roundsInput" value="6" min="2" max="20">
            </div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenAI } from "https://esm.run/@google/genai";

        const ai = new GoogleGenAI({ 
            apiKey: "AIzaSyCUgLZXuMkAPbqt4pgnOjp8Qp-BIuUc1Cs" 
        });

        const chatMessages = document.getElementById('chatMessages');
        const startButton = document.getElementById('startDebateBtn');
        const roundsInput = document.getElementById('roundsInput');

        // Funci√≥n para obtener el n√∫mero de rondas
        function getRondasMaximas() {
            return parseInt(roundsInput.value) || 6;
        }

        // Funci√≥n para agregar mensajes al chat
        function addMessage(sender, text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const senderName = sender === 'stephen' ? 'üî¨ Stephen Hawking' : 
                              sender === 'dalai' ? '‚ò∏Ô∏è Dalai Lama' : 'üí¨ Sistema';
            
            messageDiv.innerHTML = `
                <div class="message-header">${senderName}</div>
                <div class="message-content">${text}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Variables para controlar el debate
        let debateEnCurso = false;
        let rondasMaximas = 6; // N√∫mero de rondas del debate
        let conversacion = []; // Array para guardar la conversaci√≥n

        // Funci√≥n principal del debate
        async function iniciarDebate() {
            if (debateEnCurso) {
                detenerDebate();
                return;
            }

            debateEnCurso = true;
            startButton.innerHTML = '‚è∏Ô∏è Detener Debate';
            conversacion = []; // Limpiar conversaci√≥n anterior

            try {
                // Limpiar mensaje inicial
                chatMessages.innerHTML = '';

                addMessage('system', 'üé≠ Iniciando debate filos√≥fico continuo...');

                
                // Primera respuesta de Stephen Hawking
                let stephenResponse = await obtenerRespuesta('stephen', 
                    "Eres Stephen Hawking. Responde brevemente (m√°ximo 150 caracteres): ¬øQu√© hay despu√©s de la muerte seg√∫n tu visi√≥n cient√≠fica materialista?"
                );
                conversacion.push({speaker: 'stephen', text: stephenResponse});
                addMessage('stephen', stephenResponse);

                // Primera respuesta del Dalai Lama
                let dalaiResponse = await obtenerRespuesta('dalai',
                    "Eres el Dalai Lama. Responde brevemente (m√°ximo 150 caracteres): ¬øQu√© hay despu√©s de la muerte seg√∫n tu visi√≥n espiritual?"
                );
                conversacion.push({speaker: 'dalai', text: dalaiResponse});
                addMessage('dalai', dalaiResponse);

                // Bucle de debate continuo
                for (let ronda = 2; ronda < getRondasMaximas() && debateEnCurso; ronda++) {
                    // Esperar un momento entre rondas
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    if (!debateEnCurso) break; // Verificar si se detuvo el debate

                    // Stephen responde al Dalai Lama
                    addMessage('system', 'üî¨ Stephen Hawking est√° pensando...');
                    stephenResponse = await obtenerRespuesta('stephen',
                        `Eres Stephen Hawking. El Dalai Lama acaba de decir: "${dalaiResponse}". Responde con argumentos cient√≠ficos (m√°ximo 150 caracteres).`
                    );
                    conversacion.push({speaker: 'stephen', text: stephenResponse});
                    addMessage('stephen', stephenResponse);

                    if (!debateEnCurso) break;

                    // Esperar un momento
                    await new Promise(resolve => setTimeout(resolve, 2000));

                    // Dalai Lama responde a Stephen
                    addMessage('system', '‚ò∏Ô∏è Dalai Lama est√° meditando...');
                    dalaiResponse = await obtenerRespuesta('dalai',
                        `Eres el Dalai Lama. Stephen Hawking acaba de decir: "${stephenResponse}". Responde desde la espiritualidad (m√°ximo 150 caracteres).`
                    );
                    conversacion.push({speaker: 'dalai', text: dalaiResponse});
                    addMessage('dalai', dalaiResponse);
                }

                if (debateEnCurso) {
                    addMessage('system', 'üéØ Debate completado despu√©s de ' + getRondasMaximas() + ' rondas.');
                }

            } catch (error) {
                addMessage('system', `‚ùå Error: ${error.message}`);
            } finally {
                detenerDebate();
            }
        }

        // Funci√≥n para obtener respuesta de la IA
        async function obtenerRespuesta(personaje, prompt) {
            const response = await ai.models.generateContent({
                model: "gemini-2.5-flash",
                contents: [{
                    "role": "user",
                    "parts": [{
                        "text": prompt
                    }]
                }]
            });
            return response.text.substring(0, 150);
        }

        // Funci√≥n para detener el debate
        function detenerDebate() {
            debateEnCurso = false;
            startButton.innerHTML = 'üé≠ Iniciar Debate';
            startButton.disabled = false;
            if (conversacion.length > 0) {
                addMessage('system', '‚è∏Ô∏è Debate detenido. Puedes iniciar uno nuevo.');
            }
        }

        // Conectar el bot√≥n a la funci√≥n
        startButton.addEventListener('click', iniciarDebate);
    </script>
</body>
</html>